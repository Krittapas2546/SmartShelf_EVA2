# LED Controller ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà - State-Based Buffer System

## ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

#### ‡πÄ‡∏î‡∏¥‡∏° (‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß):
- `set_led(level, block, r, g, b)` - ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏µ LED ‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß
- `set_led_batch(leds)` - ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏µ LED ‡∏´‡∏•‡∏≤‡∏¢‡∏î‡∏ß‡∏á (clear ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠)
- `refresh_led_config()` - ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä config
- `clear_all_leds()` - ‡∏•‡πâ‡∏≤‡∏á LED ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

#### ‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà):
- `state = [(0, 0, 0)] * NUM_PIXELS` - Buffer ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED
- `show_state()` - ‡πÅ‡∏™‡∏î‡∏á LED ‡∏ï‡∏≤‡∏° buffer
- `set_pixels(pairs)` - ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏î‡∏ß‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
- `turn_off_some(indices)` - ‡∏î‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏î‡∏ß‡∏á
- `hard_clear(pause, repeat)` - ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ã‡πâ‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à

#### High-level Functions (‡πÉ‡∏´‡∏°‡πà):
- `set_target_blue(level, block)` - ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
- `set_target_green(level, block)` - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
- `add_error_red(level, block)` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°)

#### API Compatibility (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á):
- `set_led_batch(leds)` - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö API ‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
- `set_led(level, block, r, g, b)` - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö API ‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
- `clear_all_leds()` - ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å hard_clear()

### üéØ Logic ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà

#### 1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job:
```python
# ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå LED ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
hard_clear()
# ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô  
set_target_blue(level, block)
```

#### 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:
```python
# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
set_target_green(level, block)
# ‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
time.sleep(2)
hard_clear()
```

#### 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ú‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:
```python
# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏¥‡∏î (‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°)
add_error_red(wrong_level, wrong_block)
# ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
```

#### 4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Back:
```python
# ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡πà‡πÉ‡∏à
hard_clear()
```

### üåê API Endpoints ‡πÉ‡∏´‡∏°‡πà

#### `/api/led/control` (‡πÉ‡∏´‡∏°‡πà):
```json
{
  "level": "1",
  "block": "2", 
  "color": "blue"  // "red", "green", "blue", "yellow", "purple", "orange", "white", "off"
}
```

#### `/api/led` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á):
```json
{
  "positions": [
    {"position": "L1B1", "r": 255, "g": 0, "b": 0},
    {"position": "L1B2", "r": 0, "g": 255, "b": 0}
  ],
  "clear_first": false  // ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
}
```

#### `/api/led/clear` (‡πÄ‡∏î‡∏¥‡∏°):
```json
POST /api/led/clear
```

### üíª JavaScript Functions ‡πÉ‡∏´‡∏°‡πà

#### Frontend LED Control:
```javascript
// ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
showJobSuccess(level, block)

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏î
addErrorRedLED(level, block)

// ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡πà‡πÉ‡∏à
hardClearLEDs()

// ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° LED ‡∏ï‡∏≤‡∏° active job
controlLEDByActiveJob()
```

### üß™ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö

#### `test_led_controller.py`:
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö scenario ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô debug

#### `test_led_api.py`:
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API endpoints ‡πÉ‡∏´‡∏°‡πà
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö scenario ‡∏ú‡πà‡∏≤‡∏ô HTTP API
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö error cases

### üîÑ Migration Guide

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°:
‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô API ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô:
- `set_led_batch()` ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
- `set_led()` ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ  
- `clear_all_leds()` ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà:
‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô high-level:
- `set_target_blue()` ‡πÅ‡∏ó‡∏ô `set_led(level, block, 0, 0, 255)`
- `add_error_red()` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `set_led_batch()` ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
- `hard_clear()` ‡πÅ‡∏ó‡∏ô `clear_all_leds()`

### ‚úÖ ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà

1. **State Management**: ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED ‡πÉ‡∏ô buffer ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢
2. **Flexible Control**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö LED ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡∏ß‡∏á‡πÑ‡∏î‡πâ
3. **Reliable Clear**: `hard_clear()` ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ã‡πâ‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à
4. **Better UX**: ‡∏™‡∏µ‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô=‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢, ‡πÅ‡∏î‡∏á=‡∏ú‡∏¥‡∏î, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß=‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
5. **Backward Compatible**: API ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
6. **Easier Debugging**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô debug ‡πÅ‡∏•‡∏∞ validation ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô

### üöÄ ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö

```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LED Controller
cd /home/pi/Documents/SmartShelf_EVA2/EVA2/src
python3 test_led_controller.py

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î server ‡∏Å‡πà‡∏≠‡∏ô)
python3 test_led_api.py
```